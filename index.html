<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pipelines Showcase</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src='http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js'></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>
    <script src="./dist/vis.js"></script>
    <script src="js/index.js"></script>

    <link href="./dist/vis-network.min.css" rel="stylesheet" type="text/css"/>
    <link href="./css/style.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


    <style type="text/css">
        body, html {
            font: 10pt sans;
            line-height: 1.5em;;
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            color: #4d4d4d;
            box-sizing: border-box;
            overflow: hidden;
        }

        #header {
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
        }

        #contents {
            width: 100%;
            margin: 0 auto;
            padding: 0;
            box-sizing: border-box;
            left: 10px;
            right: 10px;
            top: 10px;
            bottom: 10px;
            display: table;
        }

        #dfdraw {
            position: absolute;
            width: 75%;
            height: 100%;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            overflow: hidden;
            display: table-cell;
        }

        #messages {
            position: absolute;
            width: 25%;
            height: 100%;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            overflow: auto;
            display: table-cell;
        }

        #dfdraw {
            top: 0;
            left: 0;
        }

        #messages {
            top: 0;
            right: 0;
        }

        #error {
            color: red;
        }

        #data {
            width: 100%;
            height: 100%;
            border: 1px solid #d3d3d3;
            box-sizing: border-box;
            resize: none;
        }

        #mynetwork {
            width: 100%;
            height: 100%;
            border: 1px solid #d3d3d3;
            box-sizing: border-box;
        }

        a:hover {
            color: red;
        }

        /* The alert message box */
        .alert {
            padding: 15px;
            background-color: #f44336;
            color: white;
            opacity: 0.83;
            transition: opacity 0.6s;
            margin-bottom: 1px;
            font-size: 125%;
            border-radius: 15px;
        }

        .alert.success {
            background-color: #4CAF50;
        }

        .alert.warning {
            background-color: #ff9800;

        }
    </style>
</head>
<body>

<div id="header">
    <div>
        <span id="error"></span>
    </div>

    <div id="contents">
        <!--Текствое окно-->
        <div id="messages">
            <div id="custom-search-input">
                <div class="input-group col-md-12">
                    <input id="text-box" type="text" class="form-control input-lg" placeholder="Search"/>
                    <span class="input-group-btn">
                        <button id="search-button" class="btn btn-info btn-lg" type="button" onclick="loadRouteLogs()">
                            <i class="glyphicon glyphicon-search"></i>
                        </button>
                    </span>
                </div>
            </div>
            <div id="data">
            </div>
        </div>

        <!--&lt;!&ndash;Форма для отображения цепочки&ndash;&gt;-->

        <div id="dfdraw">
            <div id="mynetwork"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    // // Get the input field
    var input = document.getElementById("text-box");
    // Execute a function when the user releases a key on the keyboard
    input.addEventListener("keyup", function (event) {
        // Cancel the default action, if needed
        event.preventDefault();
        // Number 13 is the "Enter" key on the keyboard
        if (event.keyCode === 13) {
            // Trigger the button element with a click
            document.getElementById("search-button").click();
        }
    });

    // setTimeout(function () {
    //     successElement('Indicates a successful or positive action')
    // }, 500);
    // setTimeout(function () {
    //     successElement('Indicates a successful or positive action')
    // }, 1250);
    // setTimeout(function () {
    //     errorElement('Indicates a dangerous or potentially negative action.')
    // }, 2000);

    // create a network
    var container = document.getElementById('mynetwork');

    var options = {
        nodes: {
            shape: 'box',
            shadow: true,
            font: {size: 18},
            widthConstraint: {minimum: 120, maximum: 170}
        },

        edges: {
            shadow: true,
            arrows: 'to'
        },

        // interaction: {
        //     keyboard: {enabled: true},
        //     multiselect: true,
        //     navigationButtons: true
        // },

        layout: {
            hierarchical: true
        }
    };

    var chains = new Set();
    var dataSetOptions = {};
    var nodes = new vis.DataSet(dataSetOptions);

    nodes.on('add', function (event, properties, senderId) {
        var addedNodes = nodes.get(properties.item);

        for (var i = 0; i < addedNodes.length; i++) {
            chains.add(addedNodes[i].chain);
        }
    });

    var edges = new vis.DataSet();
    var data = {
        nodes: nodes,
        edges: edges
    };
    var network = new vis.Network(container, data, options);

    var lastClusterZoomLevel = 0;
    var clusterFactor = 0.9;
    var clusterIndex = 0;
    var clusters = [];

    // set the first initial zoom level
    network.once('initRedraw', function () {
            if (lastClusterZoomLevel === 0) {
                lastClusterZoomLevel = network.getScale() * clusterFactor;
            }
        }
    );

    // we use the zoom event for our clustering
    network.on('zoom', function (params) {
            if (params.direction === '-') {
                if (params.scale < lastClusterZoomLevel) makeClusters(params.scale);
            }
            else {
                openClusters(params.scale);
            }
        }
    );

    // if we click on a node, we want to open it up!
    network.on("selectNode", function (params) {
        if (params.nodes.length === 1) {
            if (network.isCluster(params.nodes[0]) === true) {
                network.openCluster(params.nodes[0]);

                for (var i = 0; i < clusters.length; i++) {
                    if (clusters[i].id === params.nodes[0]) {
                        clusters.splice(i, 1);
                    }
                }
            }
        }
    });

    //focus on double click
    network.on('doubleClick', function (params) {
        // network.focus()
        var options = {
            animation: {
                duration: 1000
            }
        };
        network.focus(params.nodes[0], options)
    });

</script>
</body>
</html>
